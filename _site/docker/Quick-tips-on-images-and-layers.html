<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Quick tips on images and layers</title>
  <meta name="description" content="IntroductionIn this postI have described the difference between an image and a container, how to buildan image and how to spin up a container.In this post I ...">

  <link rel="stylesheet" href="/cheatsheets/css/main.css">
  <link rel="canonical" href="http://localhost:4000/cheatsheets/docker/Quick-tips-on-images-and-layers.html">
  <link rel="alternate" type="application/rss+xml" title="Cheat Sheets" href="http://localhost:4000/cheatsheets/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/cheatsheets/">Cheat Sheets</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Quick tips on images and layers</h1>
    <p class="post-meta"><time datetime="2018-02-11T12:54:52+00:00" itemprop="datePublished">Feb 11, 2018</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2>Introduction</h2>
<p>In <a href="/cheatsheets/docker/Spinning-up-the-first-Docker-container.html">this post</a>
I have described the difference between an image and a container, how to build
an image and how to spin up a container.
<br />
<br />
In this post I will focus on the images and briefly describe how the layered
system used by Docker works and give some tips about it.
<br /></p>
<h2>How it works</h2>
<p>Docker images work on a layered system. This means that all the single changes
we make to an image will add an extra layer to the image.</p>
<figure>
    <img src="/cheatsheets/assets/docker/img/docker-layers.png" alt="Docker layers" width="600" height="400" />
    <figcaption>Fig 1. Docker layers</figcaption>
</figure>
<p>This figure was actually taken from the official Docker documentation website.
<br />
As we can see the image layers are only readable layers and we can only write
to container layers.
<br />
It means that we can have multiple containers reading from the same image,
without the need of copying the whole content of an image every time we run a
container.
<br />
To be able to achieve this Docker uses Copy-On-Write (COW) strategy, which means
that a resource is copied to the container layer only when it is modified. This
is very important for performance and memory space.
<br /></p>
<h2>First tip: Building the image</h2>
<p>Each step of the building process adds a new layers to the image, which means
we should try to put the the most changing items at the bottom of our
Dockerfile, like in this example:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># base image</span>
FROM python:rc-alpine

<span class="c"># set entry working directory</span>
WORKDIR /usr/src/app

<span class="c"># expose port to access the app</span>
EXPOSE 8000

<span class="c"># command to run</span>
CMD <span class="o">[</span> <span class="s2">"python"</span>, <span class="s2">"./helloworld.py"</span> <span class="o">]</span>

<span class="c"># copy app to the image</span>
COPY ./helloworld.py /usr/src/app</code></pre></figure>

<p>As you can see the copy of “helloworld.py” takes place at the bottom of our
Dockerfile, because it is the most changing item. This allows us to not recreate
the same layer over and over again and therefore allows us faster build times.
<br />
Bare in mind that a Dockerfile should be easy to read and easy to understand, so
try to reconcile both worlds.
<br /></p>
<h2>Second tip: The "&lt; none &gt; images"</h2>
<p>These called “&lt; none &gt; images” are actually layers and there are two types of
<code class="highlighter-rouge">&lt; none &gt;</code> layers: The “good” ones and the “bad” ones.
<br />
<br />
Starting with the “good” ones, when we pull an image we pull all of its layers
and they are all connected to each other, Docker only gives a name to the
last one. These are the ones we see when we run <code class="highlighter-rouge">docker images -a</code>.
<br />
<br />
The “bad” ones (so called dangling images), are the ones left when we recreate
an image, they are called dangling images because they are not connected to
anything.
<br />
<br />
We can get rid of them by running the following command:
<br />
<br />
<code class="highlighter-rouge">docker rmi $(docker images --quiet --force=dangling=true)</code>
<br />
<br />
If you do not want the error message when there are no dangling images you can
run the following command (this will depend on your OS):
<br />
<br />
<code class="highlighter-rouge">docker images --quiet --force=dangling=true | xargs --no-run-if-empty docker rmi</code>
<br />
<br />
Use <code class="highlighter-rouge">docker images --quiet --force=dangling=true | xargs --no-run-if-empty docker rmi -f</code>
to force.</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          
          <a class="page-link" href="/cheatsheets/">Cheat Sheets</a>
          
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Save time with cheat sheets!
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
